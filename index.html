<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PURL Parser & Validator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .examples {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .example-link {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            margin-right: 15px;
        }
        
        .example-link:hover {
            color: #764ba2;
        }
        
        .result {
            margin-top: 20px;
        }
        
        .error {
            background: #fee;
            border-left: 4px solid #f44;
            padding: 15px;
            border-radius: 6px;
            color: #c33;
        }
        
        .success {
            background: #efe;
            border-left: 4px solid #4c4;
            padding: 15px;
            border-radius: 6px;
            color: #363;
            margin-bottom: 20px;
        }
        
        .component {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .component-label {
            font-weight: 600;
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .component-value {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            color: #333;
            word-break: break-all;
        }
        
        .component-empty {
            color: #999;
            font-style: italic;
        }
        
        .repo-link {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        
        .repo-link:hover {
            background: #764ba2;
        }
        
        .qualifiers {
            margin-top: 8px;
        }
        
        .qualifier-item {
            display: inline-block;
            background: #e8eaf6;
            padding: 4px 10px;
            border-radius: 4px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .qualifier-key {
            color: #667eea;
            font-weight: 600;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .footer a {
            color: white;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“¦ PURL Parser & Validator</h1>
            <p>Parse and validate Package URLs (PURL) according to the purl-spec standard</p>
        </div>
        
        <div class="card">
            <div class="input-group">
                <label for="purlInput">Enter a Package URL (PURL):</label>
                <input 
                    type="text" 
                    id="purlInput" 
                    placeholder="pkg:npm/express@4.17.1"
                    autocomplete="off"
                />
                <div class="examples">
                    Try: 
                    <span class="example-link" onclick="loadExample('pkg:npm/express@4.17.1')">npm</span>
                    <span class="example-link" onclick="loadExample('pkg:pypi/django@3.2.0')">pypi</span>
                    <span class="example-link" onclick="loadExample('pkg:maven/org.apache.commons/commons-lang3@3.12.0')">maven</span>
                    <span class="example-link" onclick="loadExample('pkg:docker/library/nginx@1.21.0?arch=amd64')">docker</span>
                    <span class="example-link" onclick="loadExample('pkg:github/package-url/purl-spec@244fd47e07d1004')">github</span>
                </div>
            </div>
            
            <div id="result" class="result"></div>
        </div>
        
        <div class="footer">
            Learn more about PURL at <a href="https://github.com/package-url/purl-spec" target="_blank">github.com/package-url/purl-spec</a>
        </div>
    </div>

    <script>
        function parsePURL(purl) {
            // Basic PURL regex pattern
            const purlPattern = /^pkg:([^\/]+)\/(.+)$/;
            
            if (!purl || purl.trim() === '') {
                return { error: 'Please enter a PURL' };
            }
            
            if (!purl.startsWith('pkg:')) {
                return { error: 'PURL must start with "pkg:"' };
            }
            
            const match = purl.match(purlPattern);
            if (!match) {
                return { error: 'Invalid PURL format. Expected: pkg:type/namespace/name@version' };
            }
            
            const type = match[1].toLowerCase();
            const remainder = match[2];
            
            // Split by # for subpath
            const [beforeSubpath, subpath] = remainder.split('#');
            
            // Split by ? for qualifiers
            const [beforeQualifiers, qualifiersStr] = beforeSubpath.split('?');
            
            // Parse qualifiers
            const qualifiers = {};
            if (qualifiersStr) {
                qualifiersStr.split('&').forEach(q => {
                    const [key, value] = q.split('=');
                    if (key && value) {
                        qualifiers[decodeURIComponent(key)] = decodeURIComponent(value);
                    }
                });
            }
            
            // Split by @ for version (from the right to handle namespaces with @)
            const lastAtIndex = beforeQualifiers.lastIndexOf('@');
            let namespaceName, version;
            
            if (lastAtIndex > 0) {
                namespaceName = beforeQualifiers.substring(0, lastAtIndex);
                version = beforeQualifiers.substring(lastAtIndex + 1);
            } else {
                namespaceName = beforeQualifiers;
                version = null;
            }
            
            // Split namespace and name
            const parts = namespaceName.split('/');
            let namespace, name;
            
            if (parts.length > 1) {
                name = parts.pop();
                namespace = parts.join('/');
            } else {
                namespace = null;
                name = parts[0];
            }
            
            return {
                valid: true,
                type,
                namespace: namespace || null,
                name: decodeURIComponent(name),
                version: version || null,
                qualifiers: Object.keys(qualifiers).length > 0 ? qualifiers : null,
                subpath: subpath || null
            };
        }
        
        function getRepositoryLink(parsed) {
            const { type, namespace, name, version } = parsed;
            
            const links = {
                'npm': `https://www.npmjs.com/package/${name}${version ? `/v/${version}` : ''}`,
                'pypi': `https://pypi.org/project/${name}${version ? `/${version}` : ''}/`,
                'maven': namespace ? `https://search.maven.org/artifact/${namespace}/${name}${version ? `/${version}` : ''}/jar` : null,
                'cargo': `https://crates.io/crates/${name}${version ? `/${version}` : ''}`,
                'gem': `https://rubygems.org/gems/${name}${version ? `/versions/${version}` : ''}`,
                'nuget': `https://www.nuget.org/packages/${name}${version ? `/${version}` : ''}`,
                'composer': namespace ? `https://packagist.org/packages/${namespace}/${name}` : null,
                'docker': `https://hub.docker.com/r/${namespace || 'library'}/${name}`,
                'github': namespace ? `https://github.com/${namespace}/${name}` : null,
            };
            
            return links[type] || null;
        }
        
        function displayResult(parsed) {
            const resultDiv = document.getElementById('result');
            
            if (parsed.error) {
                resultDiv.innerHTML = `<div class="error"><strong>Error:</strong> ${parsed.error}</div>`;
                return;
            }
            
            const repoLink = getRepositoryLink(parsed);
            
            let html = '<div class="success"><strong>âœ“ Valid PURL</strong></div>';
            
            html += `
                <div class="component">
                    <div class="component-label">Scheme</div>
                    <div class="component-value">pkg:</div>
                </div>
                
                <div class="component">
                    <div class="component-label">Type</div>
                    <div class="component-value">${parsed.type}</div>
                </div>
            `;
            
            if (parsed.namespace) {
                html += `
                    <div class="component">
                        <div class="component-label">Namespace</div>
                        <div class="component-value">${parsed.namespace}</div>
                    </div>
                `;
            }
            
            html += `
                <div class="component">
                    <div class="component-label">Name</div>
                    <div class="component-value">${parsed.name}</div>
                </div>
            `;
            
            if (parsed.version) {
                html += `
                    <div class="component">
                        <div class="component-label">Version</div>
                        <div class="component-value">${parsed.version}</div>
                    </div>
                `;
            }
            
            if (parsed.qualifiers) {
                let qualifiersHtml = '<div class="qualifiers">';
                for (const [key, value] of Object.entries(parsed.qualifiers)) {
                    qualifiersHtml += `<span class="qualifier-item"><span class="qualifier-key">${key}</span>=${value}</span>`;
                }
                qualifiersHtml += '</div>';
                
                html += `
                    <div class="component">
                        <div class="component-label">Qualifiers</div>
                        ${qualifiersHtml}
                    </div>
                `;
            }
            
            if (parsed.subpath) {
                html += `
                    <div class="component">
                        <div class="component-label">Subpath</div>
                        <div class="component-value">${parsed.subpath}</div>
                    </div>
                `;
            }
            
            if (repoLink) {
                html += `
                    <div class="component">
                        <div class="component-label">Repository Link</div>
                        <a href="${repoLink}" target="_blank" class="repo-link">View Package â†’</a>
                    </div>
                `;
            }
            
            resultDiv.innerHTML = html;
        }
        
        function loadExample(examplePurl) {
            document.getElementById('purlInput').value = examplePurl;
            const parsed = parsePURL(examplePurl);
            displayResult(parsed);
        }
        
        // Real-time parsing
        document.getElementById('purlInput').addEventListener('input', (e) => {
            const purl = e.target.value;
            const parsed = parsePURL(purl);
            displayResult(parsed);
        });
        
        // Load first example on page load
        window.addEventListener('load', () => {
            loadExample('pkg:npm/express@4.17.1');
        });
    </script>
</body>
</html>